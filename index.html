<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-mac-osx.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="爱生活，所以爱blog">
<meta name="keywords" content="Lee">
<meta property="og:type" content="website">
<meta property="og:title" content="Lee&#39;s Blog">
<meta property="og:url" content="http://lidongspace.cn/index.html">
<meta property="og:site_name" content="Lee&#39;s Blog">
<meta property="og:description" content="爱生活，所以爱blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lee&#39;s Blog">
<meta name="twitter:description" content="爱生活，所以爱blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lidongspace.cn/"/>





  <title>Lee's Blog</title>
  









</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lee's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">这是Lee的个人博客，记录一些技术发展和生活记录</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/我的头号玩家影评/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/我的头号玩家影评/" itemprop="url">我的头号玩家影评</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:43:23+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2,116
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>本来我不知道这部电影的信息，想着好久没去电影院看电影了，突然在发现了这部史蒂文·斯皮尔伯格的电影，我很喜欢这个电影，是少有的我记得名字的导演。忘记不了当初看辛德勒的名单时心灵受到的震撼，还有拯救大兵瑞恩等等我爱的电影。<br>看这部电影正值学校的樱花季，湘潭市过来的游客把通往科大北门的路挤得水泄不通，公交车根本不进来，害得我们白等了20多分钟，后来即使我们打了滴滴也错过了开头。</p>
</blockquote>
<h1 id="游戏梦"><a href="#游戏梦" class="headerlink" title="游戏梦"></a>游戏梦</h1><blockquote>
<p>如果说90年代以前的人们都有一个武侠梦，那么90年后的我们应该都有一个游戏梦。</p>
</blockquote>
<p>整部电影的脉络是十分清晰的，找到哈里迪藏在绿洲的三把钥匙，经过哈里德的考验，获得绿洲创伤人在公司中的全部股份。<br>电影有正面角色就有反面角色，诺兰利用人财物力直接组建了一支IOI魔王大军寻宝，这就是反面角色，有钱有势，反观正面角色韦德·霍兹同年失去父母，住在姨母家里，姨母的人渣老公是个为了玩游戏将家里所有积蓄都冲进游戏，但是成绩却永远很差的一个沉迷游戏的可怜鬼，我感觉这个人映射的是那些沉迷游戏将人生都赌在在游戏一次成功的赌徒。<br>萨曼莎是一个性感妖娆的一个游戏主播，她与韦德在第一个关卡结实，经过一段段经历，韦德爱上了这个女孩，但是当韦德表白之后却说你看到的都是我想让你看到的。这个女孩让我知道的是你永远不知道你游戏中遇到的究竟是谁，游戏里的妙龄女子说不定在现实中就是一个抠脚大汉。</p>
<p>我在豆瓣上看到了一个人用武侠故事来讲这个故事，感觉很有意思，顺便引用一下他/她的一段话</p>
<blockquote>
<p>版权归作者所有，任何形式转载请联系作者。<br>作者：木由（来自豆瓣）<br>来源：<a href="https://movie.douban.com/review/9257981/" target="_blank" rel="noopener">https://movie.douban.com/review/9257981/</a></p>
</blockquote>
<blockquote>
<p>武林第一大帮派Oasis（绿洲）的哈里迪老帮主离世，遗言宣称要把自己全部财产和武林盟主之位赠予有缘人，条件是找到三把钥匙和一颗彩蛋。武林人士一片哗然，寻宝者趋之若鹜，江湖上顿时掀起一场血雨腥风。</p>
</blockquote>
<blockquote>
<p> 大魔王诺兰利用人财物力直接组建了一支IOI魔王大军寻宝，拉开架势，顺我者昌，逆我者亡。决心寻得宝物，夺得武林盟主之位，统治天下。代表自由的游侠和处于绝对掌控地位的魔王大军就寻宝问题矛盾日益尖锐。黑云压城城欲摧，一张恶战在所难免，可惜游侠虽人数众多，却还处于散沙状态，势单力孤，群龙无首。</p>
</blockquote>
<blockquote>
<p>此时，韦德，一贫民窟少年英才横空出世。骨骼精奇，自由不羁。仗着一身好武艺和一颗七窍玲珑心闯荡江湖。无家族，无门派，不站队，独行四方。心思细腻柔软，堪称哈老帮主知音人。在揣摩了哈老帮主心思千百遍后终于领悟了其中神通，一场比赛中以出其不意的方式拔得头筹，获得第一把钥匙，一时间如宝剑出鞘，锐不可当。可惜韦德少年名声大噪的同时也吸引了魔王军团的注意。大魔王诺兰软硬兼施，拉拢韦德少年不成，杀意顿生。韦德在好友的帮助下，几次化险为夷，还顺便解锁了新钥匙。纵然魔王军团屡屡阻挠干扰，好在主角团队光环护体，一路过关斩将。</p>
</blockquote>
<blockquote>
<p>决心替哈老帮主清理门户的韦德少年只身一人闯到魔王军团城门之下，向所有饱受压迫的游侠痛斥大魔王诺兰暴行。振臂一呼，得道多助，故从者众。丧心病狂的魔王军团发起最后的反扑。失去理智的大魔王诺兰甚至不惜毁灭整个Oasis绿洲世界，只为彻底铲除男主。哪知韦德少年有哈老帮主神秘好友扫地僧的强势助攻，比常人多一血，硬是找到了第三把钥匙，获得哈老帮主真传，赢得了彩蛋，登上武林盟主宝座，抱得美人归。</p>
</blockquote>
<h1 id="三个关卡的意义"><a href="#三个关卡的意义" class="headerlink" title="三个关卡的意义"></a>三个关卡的意义</h1><p>##第一关<br>第一关是汽车竞速赛，原先大家都以为是你只要足够快，快过那个哥斯拉，你就可以取得胜利，可是过去4年了，还没有一个人完成这项任务，因为哥斯拉怪兽挡住了所有想通过的人的路线。韦德仔细看了创世人的一次讲话，大概意思如下：“我们为啥么一定要争第一呢，我们难道不能全力倒退一次么？哪怕只有10s也好，那样结果可能会完全不一样”，所以韦德在后面的比赛中急流勇退，逃离赛场，却因此破解了比赛的背后意义。<br>有时候退后一步，就是海阔天空~</p>
<p>##第二关</p>
<blockquote>
<p>第二关我看的不是很明白，论近视看电影要带电影的重要性！</p>
</blockquote>
<p>第二把钥匙的获得最戳心，同时也交代了本部电影的一条爱情隐线——年轻的哈里迪的爱。年轻时的怪胎哈里迪爱上了个姑娘，朋友问他下一步打算，他吞吞吐吐地说：“她想要去跳舞……所以……我们去看电影。”短短一句话已经交代出了哈里迪爱情失败的原因。他不懂爱人，也对自己没有自信。</p>
<p>  电影对哈里迪爱情线着墨不多，但我们知道，他拉着心上人去看了《闪灵》(ps:开始我还以为是最近netflix原创电影闪灵，没想到是斯蒂芬·金的小说改编的恐怖电影），而后来他的心上人嫁给了他的挚友。很明显这是个悲剧收场的爱情故事。而第二把钥匙就藏在他们那晚看的电影《闪灵》里。和僵尸共舞的被困住的姑娘——哈里迪的心上人，依然年轻漂亮，穿着美丽的裙子，仿佛当年约会时的模样。年轻的女主平复心情，轻声问出了当年的哈里迪没能问出的话：“我可以请你跳支舞吗？”对面的心上人笑靥如花，叹息着说：“You don’t know how long I’ve been waiting for.”（你不会知道我等这句话多久了。）这是不是现实世界哈里迪心上人的心声我们不得而知。但我们能知道的是，哈里迪曾经因为不懂她而失去了她。也许他用了余生去思考，终于明白了她，也终究失去了她。</p>
<p>  曾经沧海难为水，哈里迪把读懂他的心上人作为解锁第二把钥匙的关键，不可不谓爱之深切。至于年轻的男女主，爱情仿佛一道闪电，就这样发生了。毫无道理，无迹可寻，看似肤浅至极，但爱情的发生何尝不是如此呢。玄而又玄，找不到依据。也许年轻男主那过快的心跳就足够证明一切了，又何必非去求一个原因呢。</p>
<h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><p>第三关可以说是升华了整部电影。游戏的体验永远比通关更加有意义，你是在玩游戏而不是游戏在玩你。</p>
<p>##终极关<br>朋友比游戏要更加重要，你在游戏里如何叱咤风云，你还是需要到现实里吃饭，要活着当下，珍惜眼前的人。所以后来韦德在周二周五关闭绿洲，希望大家能够更加珍惜家人，花更多时间在现实中，现实永远是高于游戏的。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/计算机网络作业-五/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/计算机网络作业-五/" itemprop="url">计算机网络作业(五)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:42:26+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  488
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>做一个pingGUI程序，本来用MFC写的，写到一半真不想用那个垃圾框架了，干脆用Java写算了，第一次用Java写界面，有点丑。</p>
</blockquote>
<h1 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pingGUI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.icmp4j.IcmpPingUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.BorderLayout;</span><br><span class="line"><span class="keyword">import</span> java.awt.FlowLayout;</span><br><span class="line"><span class="keyword">import</span> java.awt.Frame;</span><br><span class="line"><span class="keyword">import</span> java.awt.Label;</span><br><span class="line"><span class="keyword">import</span> java.awt.Window;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.WindowAdapter;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.WindowEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.icmp4j.IcmpPingRequest;</span><br><span class="line"><span class="keyword">import</span> org.icmp4j.IcmpPingResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sample class, copyright 2009 and beyond, icmp4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">pingGUI</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the java entry point</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(<span class="keyword">final</span> String[ ] args)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	Frame f=<span class="keyword">new</span> Frame(<span class="string">"ping GUI"</span>);</span><br><span class="line">	f.setLayout(<span class="keyword">new</span> FlowLayout(FlowLayout.LEFT,<span class="number">45</span>,<span class="number">30</span>));</span><br><span class="line">	f.setSize(<span class="number">450</span>, <span class="number">500</span>);</span><br><span class="line">	f.setLocation(<span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line">	Label a=<span class="keyword">new</span> Label(<span class="string">"IP/域名"</span>);</span><br><span class="line">	f.add(a);</span><br><span class="line">	JTextField inputField;</span><br><span class="line">	inputField=<span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">	f.add(inputField);</span><br><span class="line">	MyWindowListener mw=<span class="keyword">new</span> MyWindowListener();</span><br><span class="line">	f.addWindowListener(mw);</span><br><span class="line">	Label b=<span class="keyword">new</span> Label(<span class="string">"次数"</span>);</span><br><span class="line">	f.add(b);</span><br><span class="line">	JButton start=<span class="keyword">new</span> JButton(<span class="string">"开始"</span>);</span><br><span class="line">	</span><br><span class="line">	JTextField time;</span><br><span class="line">	time=<span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">	f.add(time);</span><br><span class="line">	 JTextArea logContent=<span class="keyword">new</span> JTextArea(<span class="number">12</span>,<span class="number">30</span>);</span><br><span class="line">	 JScrollPane showPanel=<span class="keyword">new</span> JScrollPane(logContent);</span><br><span class="line">	 logContent.setEditable(<span class="keyword">false</span>);</span><br><span class="line">		JPanel inputPanel=<span class="keyword">new</span> JPanel();</span><br><span class="line">	 f.add(showPanel,BorderLayout.CENTER);</span><br><span class="line">	 f.add(inputPanel,BorderLayout.SOUTH);</span><br><span class="line">		f.add(start,BorderLayout.CENTER);</span><br><span class="line">		f.setVisible(<span class="keyword">true</span>);</span><br><span class="line">		start.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">				String content=inputField.getText();</span><br><span class="line">				String ci=time.getText();</span><br><span class="line">				<span class="keyword">int</span> ttime=Integer.parseInt(ci);</span><br><span class="line">				<span class="keyword">final</span> IcmpPingRequest request = IcmpPingUtil.createIcmpPingRequest ();</span><br><span class="line">				request.setHost (content);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// repeat a few times</span></span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> count = <span class="number">1</span>; count &lt;= ttime; count ++) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// delegate</span></span><br><span class="line">				<span class="keyword">final</span> IcmpPingResponse response = IcmpPingUtil.executePingRequest (request);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// log</span></span><br><span class="line">				<span class="keyword">final</span> String formattedResponse = IcmpPingUtil.formatResponse (response);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span>(content!=<span class="keyword">null</span>&amp;&amp;!content.trim().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">					logContent.append (formattedResponse+<span class="string">"\n"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					&#123;logContent.append(<span class="string">"域名或者IP不能为空"</span>);<span class="keyword">break</span>;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="comment">// rest</span></span><br><span class="line">		Thread.sleep (<span class="number">1000</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyWindowListener</span> <span class="keyword">extends</span> <span class="title">WindowAdapter</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>&#123;</span><br><span class="line">		Window window=e.getWindow();</span><br><span class="line">		window.setVisible(<span class="keyword">false</span>);</span><br><span class="line">		window.dispose();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="测试gif"><a href="#测试gif" class="headerlink" title="测试gif"></a>测试gif</h1><p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/11/543701623.gif?raw=true" alt="作业.gif"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>　　　用Java写出一个比较精美，并且布局相当精致的程序还是比较困难的，你需要知道怎么使用不同的布局，才能将一个程序写的相当不错。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/weka的ID3-source-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/weka的ID3-source-code/" itemprop="url">weka的ID3 source code</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:40:44+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2,244
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *   This program is free software: you can redistribute it and/or modify</span></span><br><span class="line"><span class="comment"> *   it under the terms of the GNU General Public License as published by</span></span><br><span class="line"><span class="comment"> *   the Free Software Foundation, either version 3 of the License, or</span></span><br><span class="line"><span class="comment"> *   (at your option) any later version.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   This program is distributed in the hope that it will be useful,</span></span><br><span class="line"><span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="comment"> *   GNU General Public License for more details.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   You should have received a copy of the GNU General Public License</span></span><br><span class="line"><span class="comment"> *   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    Id3.java</span></span><br><span class="line"><span class="comment"> *    Copyright (C) 1999 University of Waikato, Hamilton, New Zealand</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> weka.classifiers.trees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> weka.classifiers.AbstractClassifier;</span><br><span class="line"><span class="keyword">import</span> weka.classifiers.Sourcable;</span><br><span class="line"><span class="keyword">import</span> weka.core.Attribute;</span><br><span class="line"><span class="keyword">import</span> weka.core.Capabilities;</span><br><span class="line"><span class="keyword">import</span> weka.core.Capabilities.Capability;</span><br><span class="line"><span class="keyword">import</span> weka.core.Instance;</span><br><span class="line"><span class="keyword">import</span> weka.core.Instances;</span><br><span class="line"><span class="keyword">import</span> weka.core.NoSupportForMissingValuesException;</span><br><span class="line"><span class="keyword">import</span> weka.core.RevisionUtils;</span><br><span class="line"><span class="keyword">import</span> weka.core.TechnicalInformation;</span><br><span class="line"><span class="keyword">import</span> weka.core.TechnicalInformation.Field;</span><br><span class="line"><span class="keyword">import</span> weka.core.TechnicalInformation.Type;</span><br><span class="line"><span class="keyword">import</span> weka.core.TechnicalInformationHandler;</span><br><span class="line"><span class="keyword">import</span> weka.core.Utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;!-- globalinfo-start --&gt; Class for constructing an unpruned decision tree</span></span><br><span class="line"><span class="comment"> * based on the ID3 algorithm. Can only deal with nominal attributes. No missing</span></span><br><span class="line"><span class="comment"> * values allowed. Empty leaves may result in unclassified instances. For more</span></span><br><span class="line"><span class="comment"> * information see: &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * R. Quinlan (1986). Induction of decision trees. Machine Learning.</span></span><br><span class="line"><span class="comment"> * 1(1):81-106.</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;!-- globalinfo-end --&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;!-- technical-bibtex-start --&gt; BibTeX:</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * &amp;#64;article&#123;Quinlan1986,</span></span><br><span class="line"><span class="comment"> *    author = &#123;R. Quinlan&#125;,</span></span><br><span class="line"><span class="comment"> *    journal = &#123;Machine Learning&#125;,</span></span><br><span class="line"><span class="comment"> *    number = &#123;1&#125;,</span></span><br><span class="line"><span class="comment"> *    pages = &#123;81-106&#125;,</span></span><br><span class="line"><span class="comment"> *    title = &#123;Induction of decision trees&#125;,</span></span><br><span class="line"><span class="comment"> *    volume = &#123;1&#125;,</span></span><br><span class="line"><span class="comment"> *    year = &#123;1986&#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;!-- technical-bibtex-end --&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;!-- options-start --&gt; Valid options are:</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * -D</span></span><br><span class="line"><span class="comment"> *  If set, classifier is run in debug mode and</span></span><br><span class="line"><span class="comment"> *  may output additional info to the console</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;!-- options-end --&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Eibe Frank (eibe@cs.waikato.ac.nz)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> $Revision$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Id3</span> <span class="keyword">extends</span> <span class="title">AbstractClassifier</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class">  <span class="title">TechnicalInformationHandler</span>, <span class="title">Sourcable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** for serialization */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2693678647096322561L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** The node's successors. */</span></span><br><span class="line">  <span class="keyword">private</span> Id3[] m_Successors;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Attribute used for splitting. */</span></span><br><span class="line">  <span class="keyword">private</span> Attribute m_Attribute;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Class value if node is leaf. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> m_ClassValue;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Class distribution if node is leaf. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span>[] m_Distribution;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Class attribute of dataset. */</span></span><br><span class="line">  <span class="keyword">private</span> Attribute m_ClassAttribute;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns a string describing the classifier.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> a description suitable for the GUI.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">globalInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Class for constructing an unpruned decision tree based on the ID3 "</span></span><br><span class="line">      + <span class="string">"algorithm. Can only deal with nominal attributes. No missing values "</span></span><br><span class="line">      + <span class="string">"allowed. Empty leaves may result in unclassified instances. For more "</span></span><br><span class="line">      + <span class="string">"information see: \n\n"</span> + getTechnicalInformation().toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns an instance of a TechnicalInformation object, containing detailed</span></span><br><span class="line"><span class="comment">   * information about the technical background of this class, e.g., paper</span></span><br><span class="line"><span class="comment">   * reference or book this class is based on.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the technical information about this class</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> TechnicalInformation <span class="title">getTechnicalInformation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TechnicalInformation result;</span><br><span class="line"></span><br><span class="line">    result = <span class="keyword">new</span> TechnicalInformation(Type.ARTICLE);</span><br><span class="line">    result.setValue(Field.AUTHOR, <span class="string">"R. Quinlan"</span>);</span><br><span class="line">    result.setValue(Field.YEAR, <span class="string">"1986"</span>);</span><br><span class="line">    result.setValue(Field.TITLE, <span class="string">"Induction of decision trees"</span>);</span><br><span class="line">    result.setValue(Field.JOURNAL, <span class="string">"Machine Learning"</span>);</span><br><span class="line">    result.setValue(Field.VOLUME, <span class="string">"1"</span>);</span><br><span class="line">    result.setValue(Field.NUMBER, <span class="string">"1"</span>);</span><br><span class="line">    result.setValue(Field.PAGES, <span class="string">"81-106"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns default capabilities of the classifier.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the capabilities of this classifier</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Capabilities <span class="title">getCapabilities</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Capabilities result = <span class="keyword">super</span>.getCapabilities();</span><br><span class="line">    result.disableAll();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// attributes</span></span><br><span class="line">    result.enable(Capability.NOMINAL_ATTRIBUTES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// class</span></span><br><span class="line">    result.enable(Capability.NOMINAL_CLASS);</span><br><span class="line">    result.enable(Capability.MISSING_CLASS_VALUES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// instances</span></span><br><span class="line">    result.setMinimumNumberInstances(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Builds Id3 decision tree classifier.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data the training data</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@exception</span> Exception if classifier can't be built successfully</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildClassifier</span><span class="params">(Instances data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// can classifier handle the data?</span></span><br><span class="line">    getCapabilities().testWithFail(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remove instances with missing class</span></span><br><span class="line">    data = <span class="keyword">new</span> Instances(data);</span><br><span class="line">    data.deleteWithMissingClass();</span><br><span class="line"></span><br><span class="line">    makeTree(data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Method for building an Id3 tree.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data the training data</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@exception</span> Exception if decision tree can't be built successfully</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">makeTree</span><span class="params">(Instances data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if no instances have reached this node.</span></span><br><span class="line">    <span class="keyword">if</span> (data.numInstances() == <span class="number">0</span>) &#123;</span><br><span class="line">      m_Attribute = <span class="keyword">null</span>;</span><br><span class="line">      m_ClassValue = Utils.missingValue();</span><br><span class="line">      m_Distribution = <span class="keyword">new</span> <span class="keyword">double</span>[data.numClasses()];</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Compute attribute with maximum information gain.</span></span><br><span class="line">    <span class="keyword">double</span>[] infoGains = <span class="keyword">new</span> <span class="keyword">double</span>[data.numAttributes()];</span><br><span class="line">    Enumeration&lt;Attribute&gt; attEnum = data.enumerateAttributes();</span><br><span class="line">    <span class="keyword">while</span> (attEnum.hasMoreElements()) &#123;</span><br><span class="line">      Attribute att = attEnum.nextElement();</span><br><span class="line">      infoGains[att.index()] = computeInfoGain(data, att);</span><br><span class="line">    &#125;</span><br><span class="line">    m_Attribute = data.attribute(Utils.maxIndex(infoGains));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make leaf if information gain is zero.</span></span><br><span class="line">    <span class="comment">// Otherwise create successors.</span></span><br><span class="line">    <span class="keyword">if</span> (Utils.eq(infoGains[m_Attribute.index()], <span class="number">0</span>)) &#123;</span><br><span class="line">      m_Attribute = <span class="keyword">null</span>;</span><br><span class="line">      m_Distribution = <span class="keyword">new</span> <span class="keyword">double</span>[data.numClasses()];</span><br><span class="line">      Enumeration&lt;Instance&gt; instEnum = data.enumerateInstances();</span><br><span class="line">      <span class="keyword">while</span> (instEnum.hasMoreElements()) &#123;</span><br><span class="line">        Instance inst = instEnum.nextElement();</span><br><span class="line">        m_Distribution[(<span class="keyword">int</span>) inst.classValue()]++;</span><br><span class="line">      &#125;</span><br><span class="line">      Utils.normalize(m_Distribution);</span><br><span class="line">      m_ClassValue = Utils.maxIndex(m_Distribution);</span><br><span class="line">      m_ClassAttribute = data.classAttribute();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Instances[] splitData = splitData(data, m_Attribute);</span><br><span class="line">      m_Successors = <span class="keyword">new</span> Id3[m_Attribute.numValues()];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m_Attribute.numValues(); j++) &#123;</span><br><span class="line">        m_Successors[j] = <span class="keyword">new</span> Id3();</span><br><span class="line">        m_Successors[j].makeTree(splitData[j]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Classifies a given test instance using the decision tree.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> instance the instance to be classified</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the classification</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> NoSupportForMissingValuesException if instance has missing values</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">classifyInstance</span><span class="params">(Instance instance)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> NoSupportForMissingValuesException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (instance.hasMissingValue()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NoSupportForMissingValuesException(<span class="string">"Id3: no missing values, "</span></span><br><span class="line">        + <span class="string">"please."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (m_Attribute == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> m_ClassValue;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> m_Successors[(<span class="keyword">int</span>) instance.value(m_Attribute)]</span><br><span class="line">        .classifyInstance(instance);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Computes class distribution for instance using decision tree.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> instance the instance for which distribution is to be computed</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the class distribution for the given instance</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> NoSupportForMissingValuesException if instance has missing values</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">double</span>[] distributionForInstance(Instance instance)</span><br><span class="line">    <span class="keyword">throws</span> NoSupportForMissingValuesException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (instance.hasMissingValue()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NoSupportForMissingValuesException(<span class="string">"Id3: no missing values, "</span></span><br><span class="line">        + <span class="string">"please."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (m_Attribute == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> m_Distribution;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> m_Successors[(<span class="keyword">int</span>) instance.value(m_Attribute)]</span><br><span class="line">        .distributionForInstance(instance);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Prints the decision tree using the private toString method from below.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> a textual description of the classifier</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((m_Distribution == <span class="keyword">null</span>) &amp;&amp; (m_Successors == <span class="keyword">null</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"Id3: No model built yet."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Id3\n\n"</span> + toString(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Computes information gain for an attribute.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data the data for which info gain is to be computed</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> att the attribute</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the information gain for the given attribute and data</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if computation fails</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">computeInfoGain</span><span class="params">(Instances data, Attribute att)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> infoGain = computeEntropy(data);</span><br><span class="line">    Instances[] splitData = splitData(data, att);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; att.numValues(); j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (splitData[j].numInstances() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        infoGain -= ((<span class="keyword">double</span>) splitData[j].numInstances() / (<span class="keyword">double</span>) data</span><br><span class="line">          .numInstances()) * computeEntropy(splitData[j]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> infoGain;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Computes the entropy of a dataset.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data the data for which entropy is to be computed</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the entropy of the data's class distribution</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if computation fails</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">computeEntropy</span><span class="params">(Instances data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span>[] classCounts = <span class="keyword">new</span> <span class="keyword">double</span>[data.numClasses()];</span><br><span class="line">    Enumeration&lt;Instance&gt; instEnum = data.enumerateInstances();</span><br><span class="line">    <span class="keyword">while</span> (instEnum.hasMoreElements()) &#123;</span><br><span class="line">      Instance inst = instEnum.nextElement();</span><br><span class="line">      classCounts[(<span class="keyword">int</span>) inst.classValue()]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> entropy = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; data.numClasses(); j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (classCounts[j] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        entropy -= classCounts[j] * Utils.log2(classCounts[j]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    entropy /= data.numInstances();</span><br><span class="line">    <span class="keyword">return</span> entropy + Utils.log2(data.numInstances());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Splits a dataset according to the values of a nominal attribute.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> data the data which is to be split</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> att the attribute to be used for splitting</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the sets of instances produced by the split</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> Instances[] splitData(Instances data, Attribute att) &#123;</span><br><span class="line"></span><br><span class="line">    Instances[] splitData = <span class="keyword">new</span> Instances[att.numValues()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; att.numValues(); j++) &#123;</span><br><span class="line">      splitData[j] = <span class="keyword">new</span> Instances(data, data.numInstances());</span><br><span class="line">    &#125;</span><br><span class="line">    Enumeration&lt;Instance&gt; instEnum = data.enumerateInstances();</span><br><span class="line">    <span class="keyword">while</span> (instEnum.hasMoreElements()) &#123;</span><br><span class="line">      Instance inst = instEnum.nextElement();</span><br><span class="line">      splitData[(<span class="keyword">int</span>) inst.value(att)].add(inst);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Instances element : splitData) &#123;</span><br><span class="line">      element.compactify();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> splitData;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Outputs a tree at a certain level.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> level the level at which the tree is to be printed</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the tree as string at the given level</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> String <span class="title">toString</span><span class="params">(<span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    StringBuffer text = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_Attribute == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (Utils.isMissingValue(m_ClassValue)) &#123;</span><br><span class="line">        text.append(<span class="string">": null"</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        text.append(<span class="string">": "</span> + m_ClassAttribute.value((<span class="keyword">int</span>) m_ClassValue));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m_Attribute.numValues(); j++) &#123;</span><br><span class="line">        text.append(<span class="string">"\n"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; level; i++) &#123;</span><br><span class="line">          text.append(<span class="string">"|  "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        text.append(m_Attribute.name() + <span class="string">" = "</span> + m_Attribute.value(j));</span><br><span class="line">        text.append(m_Successors[j].toString(level + <span class="number">1</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> text.toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Adds this tree recursively to the buffer.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> id the unqiue id for the method</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> buffer the buffer to add the source code to</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the last ID being used</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if something goes wrong</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">toSource</span><span class="params">(<span class="keyword">int</span> id, StringBuffer buffer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> newID;</span><br><span class="line">    StringBuffer[] subBuffers;</span><br><span class="line"></span><br><span class="line">    buffer.append(<span class="string">"\n"</span>);</span><br><span class="line">    buffer.append(<span class="string">"  protected static double node"</span> + id + <span class="string">"(Object[] i) &#123;\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leaf?</span></span><br><span class="line">    <span class="keyword">if</span> (m_Attribute == <span class="keyword">null</span>) &#123;</span><br><span class="line">      result = id;</span><br><span class="line">      <span class="keyword">if</span> (Double.isNaN(m_ClassValue)) &#123;</span><br><span class="line">        buffer.append(<span class="string">"    return Double.NaN;"</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        buffer.append(<span class="string">"    return "</span> + m_ClassValue + <span class="string">";"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (m_ClassAttribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">        buffer.append(<span class="string">" // "</span> + m_ClassAttribute.value((<span class="keyword">int</span>) m_ClassValue));</span><br><span class="line">      &#125;</span><br><span class="line">      buffer.append(<span class="string">"\n"</span>);</span><br><span class="line">      buffer.append(<span class="string">"  &#125;\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      buffer.append(<span class="string">"    checkMissing(i, "</span> + m_Attribute.index() + <span class="string">");\n\n"</span>);</span><br><span class="line">      buffer.append(<span class="string">"    // "</span> + m_Attribute.name() + <span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// subtree calls</span></span><br><span class="line">      subBuffers = <span class="keyword">new</span> StringBuffer[m_Attribute.numValues()];</span><br><span class="line">      newID = id;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m_Attribute.numValues(); i++) &#123;</span><br><span class="line">        newID++;</span><br><span class="line"></span><br><span class="line">        buffer.append(<span class="string">"    "</span>);</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          buffer.append(<span class="string">"else "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        buffer.append(<span class="string">"if (((String) i["</span> + m_Attribute.index() + <span class="string">"]).equals(\""</span></span><br><span class="line">          + m_Attribute.value(i) + <span class="string">"\"))\n"</span>);</span><br><span class="line">        buffer.append(<span class="string">"      return node"</span> + newID + <span class="string">"(i);\n"</span>);</span><br><span class="line"></span><br><span class="line">        subBuffers[i] = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        newID = m_Successors[i].toSource(newID, subBuffers[i]);</span><br><span class="line">      &#125;</span><br><span class="line">      buffer.append(<span class="string">"    else\n"</span>);</span><br><span class="line">      buffer.append(<span class="string">"      throw new IllegalArgumentException(\"Value '\" + i["</span></span><br><span class="line">        + m_Attribute.index() + <span class="string">"] + \"' is not allowed!\");\n"</span>);</span><br><span class="line">      buffer.append(<span class="string">"  &#125;\n"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// output subtree code</span></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m_Attribute.numValues(); i++) &#123;</span><br><span class="line">        buffer.append(subBuffers[i].toString());</span><br><span class="line">      &#125;</span><br><span class="line">      subBuffers = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">      result = newID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns a string that describes the classifier as source. The classifier</span></span><br><span class="line"><span class="comment">   * will be contained in a class with the given name (there may be auxiliary</span></span><br><span class="line"><span class="comment">   * classes), and will contain a method with the signature:</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * &lt;pre&gt;</span></span><br><span class="line"><span class="comment">   * &lt;code&gt;</span></span><br><span class="line"><span class="comment">   * public static double classify(Object[] i);</span></span><br><span class="line"><span class="comment">   * &lt;/code&gt;</span></span><br><span class="line"><span class="comment">   * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * where the array &lt;code&gt;i&lt;/code&gt; contains elements that are either Double,</span></span><br><span class="line"><span class="comment">   * String, with missing values represented as null. The generated code is</span></span><br><span class="line"><span class="comment">   * public domain and comes with no warranty. &lt;br/&gt;</span></span><br><span class="line"><span class="comment">   * Note: works only if class attribute is the last attribute in the dataset.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> className the name that should be given to the source class.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the object source described by a string</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> Exception if the source can't be computed</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toSource</span><span class="params">(String className)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StringBuffer result;</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    result = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">    result.append(<span class="string">"class "</span> + className + <span class="string">" &#123;\n"</span>);</span><br><span class="line">    result</span><br><span class="line">      .append(<span class="string">"  private static void checkMissing(Object[] i, int index) &#123;\n"</span>);</span><br><span class="line">    result.append(<span class="string">"    if (i[index] == null)\n"</span>);</span><br><span class="line">    result.append(<span class="string">"      throw new IllegalArgumentException(\"Null values "</span></span><br><span class="line">      + <span class="string">"are not allowed!\");\n"</span>);</span><br><span class="line">    result.append(<span class="string">"  &#125;\n\n"</span>);</span><br><span class="line">    result.append(<span class="string">"  public static double classify(Object[] i) &#123;\n"</span>);</span><br><span class="line">    id = <span class="number">0</span>;</span><br><span class="line">    result.append(<span class="string">"    return node"</span> + id + <span class="string">"(i);\n"</span>);</span><br><span class="line">    result.append(<span class="string">"  &#125;\n"</span>);</span><br><span class="line">    toSource(id, result);</span><br><span class="line">    result.append(<span class="string">"&#125;\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result.toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns the revision string.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the revision</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getRevision</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RevisionUtils.extract(<span class="string">"$Revision$"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Main method.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> args the options for the classifier</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    runClassifier(<span class="keyword">new</span> Id3(), args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/计算机网络作业-四/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/计算机网络作业-四/" itemprop="url">计算机网络作业(四)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:39:00+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3,160
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>对socket编程我还是挺熟悉的，毕竟用过python写的shadowsocks，不过那时候时候没看过这个程序的源码，最近作业是做一个最多支持5线程的迭代服务器，最好能够支持智能回复，看了一下智能回复应该能用图灵机器人的API搞定，画出来的程序流程都大概如下所示：</p>
</blockquote>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/3258349790.jpg?raw=true" alt="IMG_20171019_210925.jpg"></p>
<h1 id="第一章："><a href="#第一章：" class="headerlink" title="第一章："></a>第一章：</h1><h1 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h1><h2 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h2><p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/1424166420.png?raw=true" alt="界面.png"></p>
<p><strong>启动服务器按钮对应代码</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Csocket_serverDlg::OnBnClickedOk()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CDialogEx::OnOK();</span><br><span class="line">	<span class="keyword">char</span> *chs = m_edit_port.GetBuffer(<span class="number">0</span>);</span><br><span class="line">	UpdateData(<span class="literal">false</span>);</span><br><span class="line">	<span class="keyword">char</span> *a[] = &#123; <span class="string">"main.exe"</span>,chs &#125;;</span><br><span class="line">	<span class="keyword">if</span> (m_edit_port)</span><br><span class="line">	&#123;</span><br><span class="line">		AfxMessageBox(<span class="string">"服务器已经开始运行"</span>);</span><br><span class="line">		main(<span class="number">2</span>,a);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		AfxMessageBox(<span class="string">"请输入端口号"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###头文件</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;io.h&gt;
#include &lt;process.h&gt;
#include &lt;winsock2.h&gt;
#include &lt;windows.h&gt;
#include&lt;ws2tcpip.h&gt;
#include &lt;iostream&gt;
using namespace std;
#pragma comment(lib, &quot;ws2_32.lib&quot;)
#define BUF_SIZE 5000
#define CO_THREAD_NUM 5
</code></pre><h3 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">error_handling</span><span class="params">(<span class="keyword">char</span> *message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	AfxMessageBox(message);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WorkThread</span><span class="params">(LPVOID lpParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SOCKET sockListen = (SOCKET)lpParam;</span><br><span class="line">	SOCKET sockSvr;</span><br><span class="line">	fd_set readSet;</span><br><span class="line">	<span class="keyword">int</span> ret;</span><br><span class="line">	timeval tv;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">5000</span>];</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		sockSvr = accept(sockListen, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span> (sockSvr == INVALID_SOCKET) &#123;</span><br><span class="line">			AfxMessageBox(<span class="string">"accept: %d "</span>, WSAGetLastError());</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			FD_ZERO(&amp;readSet);</span><br><span class="line">			FD_SET(sockSvr, &amp;readSet);</span><br><span class="line">			tv.tv_sec = <span class="number">5</span>;</span><br><span class="line">			tv.tv_usec = <span class="number">0</span>;</span><br><span class="line">			ret = select(<span class="number">0</span>, &amp;readSet, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;tv);</span><br><span class="line">			<span class="keyword">if</span> (ret == SOCKET_ERROR || ret == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				AfxMessageBox(<span class="string">"Socket %d:Sekect error &#123;%d&#125; or Timeout!\n"</span>, sockSvr, WSAGetLastError());</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (FD_ISSET(sockSvr, &amp;readSet)) &#123;</span><br><span class="line">				<span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">500</span>);</span><br><span class="line">				ret = recv(sockSvr, buf, <span class="number">5000</span>, <span class="number">0</span>);</span><br><span class="line">				<span class="comment">/*if (ret == SOCKET_ERROR || ret == 0) &#123;</span></span><br><span class="line"><span class="comment">					AfxMessageBox("recv error &#123;%d&#125; or Peer closed!\n", WSAGetLastError());</span></span><br><span class="line"><span class="comment">					break;</span></span><br><span class="line"><span class="comment">				&#125;*/</span></span><br><span class="line">				ret = send(sockSvr, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">if</span> (ret == SOCKET_ERROR)</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		closesocket(sockSvr);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WSADATA  Ws;</span><br><span class="line">	<span class="keyword">int</span> serv_sock;<span class="comment">//服务器端socket</span></span><br><span class="line">	<span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;Ws) != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		error_handling(<span class="string">"WSAStartup() error!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	sockaddr_in serv_addr;</span><br><span class="line">	<span class="comment">//	socklen_t clnt_addr_size;</span></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Usage : %s &lt;port&gt;\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	serv_sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	BOOL bReuseAddr = <span class="literal">true</span>;</span><br><span class="line">	setsockopt(serv_sock, SOL_SOCKET, SO_REUSEADDR, (<span class="keyword">char</span> *)&amp;bReuseAddr, <span class="keyword">sizeof</span>(bReuseAddr));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (serv_sock == <span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		error_handling(<span class="string">"socket() error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(&amp;serv_addr, <span class="number">0</span>, <span class="keyword">sizeof</span>(serv_addr));<span class="comment">//serv_addr全部置零，清楚变量值</span></span><br><span class="line">	serv_addr.sin_family = AF_INET;<span class="comment">//表示使用ip地址</span></span><br><span class="line">	serv_addr.sin_addr.s_addr = INADDR_ANY;<span class="comment">//INADDR_ANY表示我不在意Local IP，由系統自行決定</span></span><br><span class="line">												  <span class="comment">//若要指定IP，則使用inet_addr，例如：name.sin_addr.s_addr = inet_addr(“140.115.65.1”);</span></span><br><span class="line">												  <span class="comment">//將IP字串轉為網路位元排列，如需要反轉換，有inet_ntoa函式可用</span></span><br><span class="line">	serv_addr.sin_port = htons(atoi(argv[<span class="number">1</span>]));<span class="comment">//绑定端口</span></span><br><span class="line">	<span class="keyword">if</span> (bind(serv_sock, (sockaddr*)&amp;serv_addr, <span class="keyword">sizeof</span>(serv_addr)) == SOCKET_ERROR)<span class="comment">//绑定</span></span><br><span class="line">	&#123;</span><br><span class="line">		error_handling(<span class="string">"bind() error"</span>);	</span><br><span class="line">		WSACleanup();</span><br><span class="line">		closesocket(serv_sock); </span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (listen(serv_sock, <span class="number">5</span>) == SOCKET_ERROR)<span class="comment">//对serv_sock进行监听，5表示允许5个用户请求</span></span><br><span class="line">	&#123;</span><br><span class="line">		error_handling(<span class="string">"listen() error"</span>);	</span><br><span class="line">		WSACleanup();</span><br><span class="line">		closesocket(serv_sock);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CO_THREAD_NUM; i++)</span><br><span class="line">		_beginthread(WorkThread, <span class="number">0</span>, (LPVOID)serv_sock);</span><br><span class="line">	<span class="comment">//	clnt_addr_size = sizeof(clnt_addr);</span></span><br><span class="line">	<span class="comment">//int nSize = sizeof(SOCKADDR);</span></span><br><span class="line">	<span class="comment">/*char buffer[BUF_SIZE] = &#123; 0 &#125;;  //缓冲区</span></span><br><span class="line"><span class="comment">	for (int i = 0; i &lt; 5; i++) &#123;*/</span></span><br><span class="line">	<span class="comment">//clnt_sock = accept(serv_sock, (sockaddr*)&amp;clnt_addr, &amp;clnt_addr_size);//serv_sock接受</span></span><br><span class="line">	<span class="comment">//int strLen = recv(clnt_sock, buffer, BUF_SIZE, 0);  //接收客户端发来的数据</span></span><br><span class="line">	<span class="comment">//send(clnt_sock, message, sizeof(message), 0);  //将数据原样返回</span></span><br><span class="line">	<span class="comment">//closesocket(clnt_sock);  //关闭套接字</span></span><br><span class="line">	<span class="comment">//memset(buffer, 0, BUF_SIZE);  //重置缓冲区</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">/*if (clnt_sock == INVALID_SOCKET)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">	error_handling("accept() error");</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	send(clnt_sock, message, sizeof(message), 0);</span></span><br><span class="line"><span class="comment">	closesocket(clnt_sock);*/</span></span><br><span class="line">	Sleep(INFINITE);</span><br><span class="line"></span><br><span class="line">	closesocket(serv_sock);</span><br><span class="line">	WSACleanup();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h1><h2 id="控制台客户端（已实现）"><a href="#控制台客户端（已实现）" class="headerlink" title="控制台客户端（已实现）"></a>控制台客户端（已实现）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// socket_test_cilent.cpp: 定义控制台应用程序的入口点。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;process.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"ws2_32.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Ws2tcpip.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUF_SIZE 5000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SOCKET sock;</span><br><span class="line">	<span class="keyword">char</span> bufSend[BUF_SIZE];</span><br><span class="line">	<span class="keyword">char</span> bufRecv[BUF_SIZE];</span><br><span class="line">	sockaddr_in sockAddr;</span><br><span class="line">	<span class="keyword">char</span> message[<span class="number">30</span>];</span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Usage : %s &lt;IP&gt; &lt;port&gt;\n "</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//初始化DLL</span></span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData) != <span class="number">0</span>)</span><br><span class="line">		ErrorHandling(<span class="string">"WSAStartup() error!"</span>);</span><br><span class="line">	<span class="comment">//向服务器发起请求</span></span><br><span class="line"></span><br><span class="line">	sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (sock == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		ErrorHandling(<span class="string">"socket() error"</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(&amp;sockAddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(sockAddr));  <span class="comment">//每个字节都用0填充</span></span><br><span class="line">	sockAddr.sin_family = PF_INET;</span><br><span class="line">	<span class="comment">//	sockAddr.sin_addr.s_addr = inet_addr(argv[1]);</span></span><br><span class="line"></span><br><span class="line">	InetPton(AF_INET, argv[<span class="number">1</span>], &amp;sockAddr.sin_addr);</span><br><span class="line">	sockAddr.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line">	<span class="keyword">if</span> (connect(sock, (SOCKADDR*)&amp;sockAddr, <span class="keyword">sizeof</span>(SOCKADDR)) == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (sock != INVALID_SOCKET)</span><br><span class="line">			closesocket(sock);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		ErrorHandling(<span class="string">"connect() error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"成功连接"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//获取用户输入的字符串并发送给服务器</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"请输入要向服务器发送的信息：\n"</span>);</span><br><span class="line">	fd_set readSet;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret, len;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memset</span>(bufSend, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">		gets_s(bufSend);</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufSend, <span class="string">"quit\n"</span>) || !<span class="built_in">strcmp</span>(bufSend, <span class="string">"QUIT\n"</span>) || !<span class="built_in">strcmp</span>(bufSend, <span class="string">"Quit\n"</span>))</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			WSACleanup();  <span class="comment">//终止使用 DLL</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"你已经退出"</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		len = <span class="built_in">strlen</span>(bufSend);</span><br><span class="line">		<span class="keyword">if</span> (len &gt; <span class="number">997</span>)</span><br><span class="line">			len = <span class="number">997</span>;</span><br><span class="line">		bufSend[len] = <span class="string">'\r'</span>;</span><br><span class="line">		bufSend[len + <span class="number">1</span>] = <span class="string">'\n'</span>;</span><br><span class="line">		bufSend[len + <span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">		ret = send(sock, bufSend, <span class="built_in">strlen</span>(bufSend), <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (ret == SOCKET_ERROR) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"send:%d\n"</span>, WSAGetLastError());</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		FD_ZERO(&amp;readSet);</span><br><span class="line">		FD_SET(sock, &amp;readSet);</span><br><span class="line">		tv.tv_sec = <span class="number">3</span>;</span><br><span class="line">		tv.tv_usec = <span class="number">0</span>;</span><br><span class="line">		ret = select(<span class="number">0</span>, &amp;readSet, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span> (ret == SOCKET_ERROR) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"select: %d"</span>, WSAGetLastError());</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (ret == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"TimeOut,No Response From Server\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (FD_ISSET(sock, &amp;readSet)) &#123;</span><br><span class="line">			<span class="built_in">memset</span>(bufRecv, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">			ret = recv(sock, bufRecv, <span class="number">1000</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (ret == SOCKET_ERROR) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"recv: %d\n"</span>, WSAGetLastError());</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, bufRecv);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (sock != INVALID_SOCKET)</span><br><span class="line">		&#123;</span><br><span class="line">			closesocket(sock);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Stopped.\n"</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">fputs</span>(message,<span class="built_in">stderr</span>);</span><br><span class="line">	fputc(<span class="string">'\n'</span>, <span class="built_in">stderr</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="测试gif"><a href="#测试gif" class="headerlink" title="测试gif"></a>测试gif</h3><p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/1243757725.gif?raw=true" alt="服务器端测试.gif"></p>
<h2 id="调用图灵机器人（暂未实现）"><a href="#调用图灵机器人（暂未实现）" class="headerlink" title="调用图灵机器人（暂未实现）"></a>调用图灵机器人（暂未实现）</h2><blockquote>
<p>能力有限，不知道怎么整合MFC程序和这个winhttp的程序整合</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winhttp.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"winhttp.lib"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TULING_URL  <span class="meta-string">L"www.tuling123.com/openapi/api?key=这里换成你自己从图灵申请的API啦&amp;info=%s"</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">wchar_t</span> String[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//编码转换</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">UnicodeToANSI</span><span class="params">(<span class="keyword">const</span> <span class="keyword">wchar_t</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> result[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">int</span> len = WideCharToMultiByte(CP_ACP, <span class="number">0</span>, str, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    WideCharToMultiByte(CP_ACP, <span class="number">0</span>, str, <span class="number">-1</span>, result, len, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    result[len] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">wchar_t</span> *UTF8ToUnicode(<span class="keyword">const</span> <span class="keyword">char</span> *str)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">wchar_t</span> result[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">int</span> len = MultiByteToWideChar(CP_UTF8, <span class="number">0</span>, str, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    MultiByteToWideChar(CP_UTF8, <span class="number">0</span>, str, <span class="number">-1</span>, result, len);</span><br><span class="line">    result[len] = L'\<span class="number">0'</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">wchar_t</span> *ANSIToUnicode(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> textlen;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">wchar_t</span> result[<span class="number">1024</span>];</span><br><span class="line">    textlen = MultiByteToWideChar(CP_ACP, <span class="number">0</span>, str, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(result, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * (textlen + <span class="number">1</span>));</span><br><span class="line">    MultiByteToWideChar(CP_ACP, <span class="number">0</span>, str, <span class="number">-1</span>, (LPWSTR)result, textlen);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">GetHttpPage</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DWORD dwSize = <span class="number">0</span>;</span><br><span class="line">    DWORD dwDownloaded = <span class="number">0</span>;</span><br><span class="line">    LPSTR pszOutBuffer = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">static</span> HINTERNET hSession = WinHttpOpen(<span class="string">L"A Tuling API Example Program/1.0"</span>, WINHTTP_ACCESS_TYPE_DEFAULT_PROXY, WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">static</span> HINTERNET hConnect = <span class="literal">NULL</span>, hRequest = <span class="literal">NULL</span>;</span><br><span class="line">    BOOL  bResults = FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从控制台读出一行文字，注意读出来的内容是ANSI编码的，我们需要转换成 Unicode编码</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> uin[<span class="number">1024</span>]; gets_s(uin);</span><br><span class="line">    wsprintf(String, TULING_URL, ANSIToUnicode(uin));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建立一个http的连接会话，给出主机名就行，可以域名，也可以是IP地址，不需要http;前缀</span></span><br><span class="line">    <span class="keyword">if</span> (hSession)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!hConnect)</span><br><span class="line">            hConnect = WinHttpConnect(hSession, <span class="string">L"www.tuling123.com"</span>, INTERNET_DEFAULT_HTTP_PORT, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个HTTP请求句柄</span></span><br><span class="line">    <span class="keyword">if</span> (hConnect)</span><br><span class="line">        hRequest = WinHttpOpenRequest(hConnect, <span class="string">L"GET"</span>, String, <span class="literal">NULL</span>, WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, WINHTTP_FLAG_ESCAPE_PERCENT | WINHTTP_FLAG_REFRESH);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送请求数据</span></span><br><span class="line">    <span class="keyword">if</span> (hRequest)</span><br><span class="line">        bResults = WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, <span class="number">0</span>, WINHTTP_NO_REQUEST_DATA, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求结束，接收数据</span></span><br><span class="line">    <span class="keyword">if</span> (bResults)</span><br><span class="line">        bResults = WinHttpReceiveResponse(hRequest, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Error %d has occurred.\n"</span>, GetLastError());</span><br><span class="line">    <span class="comment">//如果返回值为false，可以使用getlasterror来得到错误信息，下同</span></span><br><span class="line">    <span class="comment">//返回值的详细信息可以看微软网页，或者看这里翻译好的中文接口说明</span></span><br><span class="line">    <span class="comment">//http://blog.csdn.net/fengsh998/article/details/8201591</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内部使用的一个循环来确保能接受到所有数据</span></span><br><span class="line">    <span class="keyword">if</span> (bResults)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//检查是否还有数据需要接收</span></span><br><span class="line">            dwSize = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!WinHttpQueryDataAvailable(hRequest, &amp;dwSize))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Error %u in WinHttpQueryDataAvailable.\n"</span>, GetLastError());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!dwSize)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//为缓冲分配内存并读取</span></span><br><span class="line">            pszOutBuffer = <span class="keyword">new</span> <span class="keyword">char</span>[dwSize + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!pszOutBuffer)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Out of memory\n"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ZeroMemory(pszOutBuffer, dwSize + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &amp;dwDownloaded))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Error %u in WinHttpReadData.\n"</span>, GetLastError());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//图灵api返回来的内容使用的是UTF-8编码，我们需要把它转换回ANSI才能在控制台显示</span></span><br><span class="line">                <span class="comment">//printf("return:%s\n", UnicodeToANSI(UTF8ToUnicode(pszOutBuffer)) );</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//因为没有使用JSON库，所以我暴力拆了这字符串。</span></span><br><span class="line">                pszOutBuffer[<span class="built_in">strlen</span>(pszOutBuffer)<span class="number">-2</span>] = <span class="string">'\0'</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"小灵:%s\n\n"</span>, UnicodeToANSI(UTF8ToUnicode(pszOutBuffer)) + <span class="number">23</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">delete</span>[] pszOutBuffer; </span><br><span class="line">            <span class="keyword">if</span> (!dwDownloaded)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> (dwSize &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//收尾，关闭被打开的句柄</span></span><br><span class="line">    <span class="keyword">if</span> (hRequest) WinHttpCloseHandle(hRequest);</span><br><span class="line">    <span class="keyword">if</span> (hConnect) WinHttpCloseHandle(hConnect);</span><br><span class="line">    <span class="keyword">if</span> (hSession) WinHttpCloseHandle(hSession);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    system(<span class="string">"color F0"</span>);</span><br><span class="line">    system(<span class="string">"title 会聊天的图灵机器人 ●﹏●"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n  我是小灵，快来和我聊天吧! ●▽●\n\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span>&#123; <span class="built_in">printf</span>(<span class="string">"我："</span>); &#125; <span class="keyword">while</span> (GetHttpPage());</span><br><span class="line"></span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="客户端带界面版本（有问题，未调试）"><a href="#客户端带界面版本（有问题，未调试）" class="headerlink" title="客户端带界面版本（有问题，未调试）"></a>客户端带界面版本（有问题，未调试）</h2><p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/964509500.png?raw=true" alt="客户端界面.png"><br><strong>发送按钮对应的实现代码</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Csocket_clientDlg::OnBnClickedButton2()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	UpdateData(<span class="literal">true</span>);</span><br><span class="line">	<span class="keyword">char</span> *ip = m_edit_servaddr.GetBuffer(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">char</span> *port = m_edit_servport.GetBuffer(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">char</span> *argv[] = &#123; <span class="string">"main.exe"</span>,ip,port &#125;;</span><br><span class="line">	CString str;</span><br><span class="line">	m_chatedit.GetWindowTextA(str);</span><br><span class="line">	<span class="built_in">string</span> str1 = str.GetBuffer(<span class="number">0</span>);</span><br><span class="line">	strcpy_s(bufSend, str1.c_str());</span><br><span class="line">	UpdateData(<span class="literal">false</span>);</span><br><span class="line">	main(<span class="number">3</span>, argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="主要代码-1"><a href="#主要代码-1" class="headerlink" title="主要代码"></a>主要代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Csocket_clientDlg mfc;</span><br><span class="line">	SOCKET sock;</span><br><span class="line">	sockaddr_in sockAddr;</span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//printf("Usage : %s &lt;IP&gt; &lt;port&gt;\n ", argv[0]);</span></span><br><span class="line">		AfxMessageBox(<span class="string">"Usage : main.exe &lt;IP&gt; &lt;port&gt;\n "</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//初始化DLL</span></span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData) != <span class="number">0</span>)</span><br><span class="line">		ErrorHandling(<span class="string">"WSAStartup() error!"</span>);</span><br><span class="line">	<span class="comment">//向服务器发起请求</span></span><br><span class="line"></span><br><span class="line">	sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (sock == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		ErrorHandling(<span class="string">"socket() error"</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(&amp;sockAddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(sockAddr));  <span class="comment">//每个字节都用0填充</span></span><br><span class="line">	sockAddr.sin_family = PF_INET;</span><br><span class="line">	<span class="comment">//	sockAddr.sin_addr.s_addr = inet_addr(argv[1]);</span></span><br><span class="line"></span><br><span class="line">	InetPton(AF_INET, argv[<span class="number">1</span>], &amp;sockAddr.sin_addr);</span><br><span class="line">	sockAddr.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line">	<span class="keyword">if</span> (connect(sock, (SOCKADDR*)&amp;sockAddr, <span class="keyword">sizeof</span>(SOCKADDR)) == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (sock != INVALID_SOCKET)</span><br><span class="line">			closesocket(sock);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		ErrorHandling(<span class="string">"connect() error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//printf("成功连接");</span></span><br><span class="line">		AfxMessageBox(<span class="string">"成功连接"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fd_set readSet;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line">	<span class="keyword">int</span> ret, len;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufSend, <span class="string">"quit\n"</span>) || !<span class="built_in">strcmp</span>(bufSend, <span class="string">"QUIT\n"</span>) || !<span class="built_in">strcmp</span>(bufSend, <span class="string">"Quit\n"</span>))</span><br><span class="line">		&#123;</span><br><span class="line"></span><br><span class="line">			WSACleanup();  <span class="comment">//终止使用 DLL</span></span><br><span class="line">			AfxMessageBox(<span class="string">"你已经退出"</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		len = <span class="built_in">strlen</span>(bufSend);</span><br><span class="line">		<span class="keyword">if</span> (len &gt; <span class="number">997</span>)</span><br><span class="line">			len = <span class="number">997</span>;</span><br><span class="line">		bufSend[len] = <span class="string">'\r'</span>;</span><br><span class="line">		bufSend[len + <span class="number">1</span>] = <span class="string">'\n'</span>;</span><br><span class="line">		bufSend[len + <span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">		ret = send(sock, bufSend, <span class="built_in">strlen</span>(bufSend), <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (ret == SOCKET_ERROR) &#123;</span><br><span class="line">			AfxMessageBox(<span class="string">"send:%d\n"</span>, WSAGetLastError());</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		FD_ZERO(&amp;readSet);</span><br><span class="line">		FD_SET(sock, &amp;readSet);</span><br><span class="line">		tv.tv_sec = <span class="number">3</span>;</span><br><span class="line">		tv.tv_usec = <span class="number">0</span>;</span><br><span class="line">		ret = select(<span class="number">0</span>, &amp;readSet, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span> (ret == SOCKET_ERROR) &#123;</span><br><span class="line">			AfxMessageBox(<span class="string">"select: %d"</span>, WSAGetLastError());</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (ret == <span class="number">0</span>) &#123;</span><br><span class="line">			AfxMessageBox(<span class="string">"TimeOut,No Response From Server\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (FD_ISSET(sock, &amp;readSet)) &#123;</span><br><span class="line">			<span class="built_in">memset</span>(bufRecv, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">			ret = recv(sock, bufRecv, <span class="number">1000</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (ret == SOCKET_ERROR) &#123;</span><br><span class="line">				AfxMessageBox(<span class="string">"recv: %d\n"</span>, WSAGetLastError());</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				mfc.m_chatlog.SetSel(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">				mfc.m_chatlog.ReplaceSel((LPCTSTR)bufRecv);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (sock != INVALID_SOCKET)</span><br><span class="line">		&#123;</span><br><span class="line">			closesocket(sock);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	WSACleanup();</span><br><span class="line">	AfxMessageBox(<span class="string">"Stopped.\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	AfxMessageBox(message);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><p>stdafx.h<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"ws2_32.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span>;</span><br><span class="line"><span class="keyword">extern</span> SOCKET sock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUF_SIZE 5000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">extern</span> 	<span class="keyword">char</span> bufSend[BUF_SIZE];</span><br><span class="line"><span class="keyword">extern</span>  <span class="keyword">char</span> bufRecv[BUF_SIZE];</span><br><span class="line"><span class="keyword">extern</span> sockaddr_in sockAddr;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> count;</span><br></pre></td></tr></table></figure></p>
<p>stdafx.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SOCKET sock;</span><br><span class="line"><span class="keyword">char</span> bufSend[BUF_SIZE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">char</span> bufRecv[BUF_SIZE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">sockaddr_in sockAddr;</span><br><span class="line"><span class="keyword">int</span> count=<span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h1><h2 id="客户端界面"><a href="#客户端界面" class="headerlink" title="客户端界面"></a>客户端界面</h2><p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/1844337240.png?raw=true" alt="第二章界面.png"><br><strong>连接按钮对应代码</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *ip = m_addr.GetBuffer(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">char</span> *port = m_port.GetBuffer(<span class="number">0</span>);</span><br><span class="line">UpdateData(<span class="literal">false</span>);</span><br><span class="line">	<span class="keyword">char</span> *argv[] = &#123; <span class="string">"main.exe"</span>,ip,port &#125;;</span><br><span class="line">	main(<span class="number">3</span>, argv);</span><br></pre></td></tr></table></figure></p>
<h2 id="主程序代码"><a href="#主程序代码" class="headerlink" title="主程序代码"></a>主程序代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CTCPsocketDlg mfc;</span><br><span class="line">	SOCKET sock;</span><br><span class="line">	sockaddr_in sockAddr;</span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//printf("Usage : %s &lt;IP&gt; &lt;port&gt;\n ", argv[0]);</span></span><br><span class="line">		AfxMessageBox(<span class="string">"Usage : main.exe &lt;IP&gt; &lt;port&gt;\n "</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//初始化DLL</span></span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData) != <span class="number">0</span>)</span><br><span class="line">		ErrorHandling(<span class="string">"WSAStartup() error!"</span>);</span><br><span class="line">	<span class="comment">//向服务器发起请求</span></span><br><span class="line">	<span class="keyword">char</span> message[<span class="number">30</span>];</span><br><span class="line">	<span class="keyword">int</span> <span class="built_in">strlen</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> idx = <span class="number">0</span>, readlen = <span class="number">0</span>;</span><br><span class="line">	sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (sock == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		ErrorHandling(<span class="string">"socket() error"</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">memset</span>(&amp;sockAddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(sockAddr));  <span class="comment">//每个字节都用0填充</span></span><br><span class="line">	sockAddr.sin_family = PF_INET;</span><br><span class="line"><span class="comment">//	sockAddr.sin_addr.s_addr = inet_addr(argv[1]);</span></span><br><span class="line"></span><br><span class="line">	InetPton(AF_INET, argv[<span class="number">1</span>], &amp;sockAddr.sin_addr);</span><br><span class="line">	sockAddr.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line">	<span class="keyword">if</span> (connect(sock, (SOCKADDR*)&amp;sockAddr, <span class="keyword">sizeof</span>(SOCKADDR)) == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/*if (sock != INVALID_SOCKET)</span></span><br><span class="line"><span class="comment">			closesocket(sock);</span></span><br><span class="line"><span class="comment">		WSACleanup();*/</span></span><br><span class="line">		ErrorHandling(<span class="string">"connect() error"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*else</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		//printf("成功连接");</span></span><br><span class="line"><span class="comment">		AfxMessageBox("成功连接");</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	<span class="keyword">while</span> (readlen = recv(sock, &amp;message[idx++], <span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (readlen == <span class="number">-1</span>)</span><br><span class="line">			ErrorHandling(<span class="string">"read() error!"</span>);</span><br><span class="line">			<span class="built_in">strlen</span>+= readlen;</span><br><span class="line">	&#125;</span><br><span class="line">	mfc.m_mess = message;</span><br><span class="line">	mfc.m_read_count = <span class="built_in">strlen</span>;</span><br><span class="line">	closesocket(sock);</span><br><span class="line">	WSACleanup();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrorHandling</span><span class="params">(<span class="keyword">char</span>* message)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	AfxMessageBox(message);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="35页第6题"><a href="#35页第6题" class="headerlink" title="35页第6题"></a>35页第6题</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">将客户端内的</span><br><span class="line"><span class="keyword">while</span> (readlen = recv(sock, &amp;message[idx++], <span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (readlen == <span class="number">-1</span>)</span><br><span class="line">			ErrorHandling(<span class="string">"read() error!"</span>);</span><br><span class="line">			<span class="built_in">strlen</span>+= readlen;</span><br><span class="line">	&#125;</span><br><span class="line">改为</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3000</span>:i++)</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"write Busy"</span>);</span><br><span class="line"><span class="keyword">while</span> (readlen = recv(sock, &amp;message[idx++], <span class="built_in">strlen</span>(message), <span class="number">0</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (readlen == <span class="number">-1</span>)</span><br><span class="line">			ErrorHandling(<span class="string">"read() error!"</span>);</span><br><span class="line">			<span class="built_in">strlen</span>+= readlen;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">将服务器端内的</span><br><span class="line">	send(sock,message,<span class="built_in">strlen</span>(message),<span class="number">0</span>);</span><br><span class="line">	改为</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strlen</span>(message)&gt;<span class="number">0</span>)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(message);i++)</span><br><span class="line">	write(sock,message,<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"write() error!"</span>);</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>   我再也不想用mfc工程写GUI界面了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/mfc工程控件中调用main（int-argc-char-argv-函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/mfc工程控件中调用main（int-argc-char-argv-函数/" itemprop="url">mfc工程控件中调用main（int argc,char *argv[])函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:36:09+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  155
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在一个vc工程中调用.c文件中的main函数<br>int main(int argc,char *argv[])vc中用什么类型表示字符串数组，然后怎么样向c中的main函数传递过去？</p>
</blockquote>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><p><strong>首先确定你是要直接调用main函数，还是要加载C编译好的exe文件。</strong><br>假设你要传1、2、3三个参数,C程序编译生成的exe文件名是main.exe。</p>
<p>###如果是要直接调用main函数，则<br>char *argv[] = {“main.exe”, “1”, “2”, “3”};<br>main(4, argv);</p>
<p>###如果是要加载C编译好的exe文件，则<br>char args[] = “1 2 3”;<br>ShellExecute(NULL, “open”, “main.exe”, args, NULL, SW_HIDE);</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/循序渐进Socket网络编程（多客户端、信息共享、文件传输）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/循序渐进Socket网络编程（多客户端、信息共享、文件传输）/" itemprop="url">循序渐进Socket网络编程（多客户端、信息共享、文件传输）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:30:13+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1,722
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>前言：在最近一个即将结束的项目中使用到了Socket编程，用于调用另一系统进行处理并返回数据。故把Socket的基础知识总结梳理一遍。</p>
</blockquote>
<h1 id="1、TCP-IP协议"><a href="#1、TCP-IP协议" class="headerlink" title="1、TCP/IP协议"></a>1、TCP/IP协议</h1><p>　　既然是网络编程，涉及几个系统之间的交互，那么首先要考虑的是如何准确的定位到网络上的一台或几台主机，另一个是如何进行可靠高效的数据传输。这里就要使用到TCP/IP协议。</p>
<p>　　TCP/IP协议（传输控制协议）由网络层的IP协议和传输层的TCP协议组成。IP层负责网络主机的定位，数据传输的路由，由IP地址可以唯一的确定Internet上的一台主机。TCP层负责面向应用的可靠的或非可靠的数据传输机制，这是网络编程的主要对象。</p>
<h1 id="2、TCP与UDP"><a href="#2、TCP与UDP" class="headerlink" title="2、TCP与UDP"></a>2、TCP与UDP</h1><p>　　TCP是一种面向连接的保证可靠传输的协议。通过TCP协议传输，得到的是一个顺序的无差错的数据流。发送方和接收方的成对的两个socket之间必须建立连接，以便在TCP协议的基础上进行通信，当一个socket（通常都是server socket）等待建立连接时，另一个socket可以要求进行连接，一旦这两个socket连接起来，它们就可以进行双向数据传输，双方都可以进行发送或接收操作。</p>
<p>　　UDP是一种面向无连接的协议，每个数据报都是一个独立的信息，包括完整的源地址或目的地址，它在网络上以任何可能的路径传往目的地，因此能否到达目的地，到达目的地的时间以及内容的正确性都是不能被保证的。</p>
<h2 id="TCP与UDP区别："><a href="#TCP与UDP区别：" class="headerlink" title="　　TCP与UDP区别："></a>　　TCP与UDP区别：</h2><h3 id="TCP特点："><a href="#TCP特点：" class="headerlink" title="　　TCP特点："></a>　　TCP特点：</h3><p>TCP是面向连接的协议，通过三次握手建立连接，通讯完成时要拆除连接，由于TCP是面向连接协议，所以只能用于点对点的通讯。而且建立连接也需要消耗时间和开销。<br>TCP传输数据无大小限制，进行大数据传输。<br>TCP是一个可靠的协议，它能保证接收方能够完整正确地接收到发送方发送的全部数据。</p>
<h3 id="UDP特点："><a href="#UDP特点：" class="headerlink" title="　　UDP特点："></a>　　UDP特点：</h3><p>UDP是面向无连接的通讯协议，UDP数据包括目的端口号和源端口号信息，由于通讯不需要连接，所以可以实现广播发送。<br>UDP传输数据时有大小限制，每个被传输的数据报必须限定在64KB之内。<br>UDP是一个不可靠的协议，发送方所发送的数据报并不一定以相同的次序到达接收方。</p>
<h3 id="TCP与UDP应用："><a href="#TCP与UDP应用：" class="headerlink" title="　　TCP与UDP应用："></a>　　TCP与UDP应用：</h3><p>TCP在网络通信上有极强的生命力，例如远程连接（Telnet）和文件传输（FTP）都需要不定长度的数据被可靠地传输。但是可靠的传输是要付出代价的，对数据内容正确性的检验必然占用计算机的处理时间和网络的带宽，因此TCP传输的效率不如UDP高。<br>UDP操作简单，而且仅需要较少的监护，因此通常用于局域网高可靠性的分散系统中client/server应用程序。例如视频会议系统，并不要求音频视频数据绝对的正确，只要保证连贯性就可以了，这种情况下显然使用UDP会更合理一些。</p>
<h1 id="3、Socket是什么"><a href="#3、Socket是什么" class="headerlink" title="3、Socket是什么"></a>3、Socket是什么</h1><p>　　Socket通常也称作”套接字”，用于描述IP地址和端口，是一个通信链的句柄。网络上的两个程序通过一个双向的通讯连接实现数据的交换，这个双向链路的一端称为一个Socket，一个Socket由一个IP地址和一个端口号唯一确定。应用程序通常通过”套接字”向网络发出请求或者应答网络请求。 Socket是TCP/IP协议的一个十分流行的编程界面，但是，Socket所支持的协议种类也不光TCP/IP一种，因此两者之间是没有必然联系的。在Java环境下，Socket编程主要是指基于TCP/IP协议的网络编程。</p>
<p>　　Socket通讯过程：服务端监听某个端口是否有连接请求，客户端向服务端发送连接请求，服务端收到连接请求向客户端发出接收消息，这样一个连接就建立起来了。客户端和服务端都可以相互发送消息与对方进行通讯。</p>
<p>　　Socket的基本工作过程包含以下四个步骤：</p>
<p>创建Socket；<br>打开连接到Socket的输入输出流；<br>按照一定的协议对Socket进行读写操作；<br>关闭Socket。</p>
<h1 id="4、多客户端连接服务器"><a href="#4、多客户端连接服务器" class="headerlink" title="4、多客户端连接服务器"></a>4、多客户端连接服务器</h1><p>　　上面的服务器端程序一次只能连接一个客户端，这在实际应用中显然是不可能的。通常的网络环境是多个客户端连接到某个主机进行通讯，所以我们要对上面的程序进行改造。</p>
<p>　　<strong>设计思路：服务器端主程序监听某一个端口，客户端发起连接请求，服务器端主程序接收请求，同时构造一个线程类，用于接管会话。当一个Socket会话产生后，这个会话就会交给线程进行处理，主程序继续进行监听。</strong></p>
<p>　　下面的实现程序流程是：客户端和服务器建立连接，客户端发送消息，服务端根据消息进行处理并返回消息，若客户端申请关闭，则服务器关闭此连接，双方通讯结束。</p>
<p>　　客户端程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.socket;<span class="keyword">import</span> java.io.BufferedReader;<span class="keyword">import</span> java.io.InputStreamReader;<span class="keyword">import</span> java.io.PrintWriter;<span class="keyword">import</span> java.net.Socket;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span> </span>&#123;    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        <span class="keyword">try</span> &#123;            Socket socket = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>, <span class="number">2013</span>);            socket.setSoTimeout(<span class="number">60000</span>);            PrintWriter printWriter = <span class="keyword">new</span> PrintWriter(socket.getOutputStream(), <span class="keyword">true</span>);            BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));            String result = <span class="string">""</span>;            <span class="keyword">while</span>(result.indexOf(<span class="string">"bye"</span>) == -<span class="number">1</span>)&#123;                BufferedReader sysBuff = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));                printWriter.println(sysBuff.readLine());                printWriter.flush();                result = bufferedReader.readLine();                System.out.println(<span class="string">"Server say : "</span> + result);            &#125;            printWriter.close();            bufferedReader.close();            socket.close();        &#125; <span class="keyword">catch</span> (Exception e) &#123;            System.out.println(<span class="string">"Exception:"</span> + e);        &#125;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>服务器端程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.socket;<span class="keyword">import</span> java.io.*;<span class="keyword">import</span> java.net.*;<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> <span class="keyword">extends</span> <span class="title">ServerSocket</span> </span>&#123;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVER_PORT = <span class="number">2013</span>;    <span class="function"><span class="keyword">public</span> <span class="title">Server</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;        <span class="keyword">super</span>(SERVER_PORT);        <span class="keyword">try</span> &#123;            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;                Socket socket = accept();                <span class="keyword">new</span> CreateServerThread(socket);<span class="comment">//当有请求时，启一个线程处理            &#125;        &#125; catch (IOException e) &#123;        &#125; finally &#123;            close();        &#125;    &#125;    //线程类    class CreateServerThread extends Thread &#123;        private Socket client;        private BufferedReader bufferedReader;        private PrintWriter printWriter;        public CreateServerThread(Socket s) throws IOException &#123;            client = s;            bufferedReader = new BufferedReader(new InputStreamReader(client.getInputStream()));            printWriter = new PrintWriter(client.getOutputStream(), true);            System.out.println("Client(" + getName() + ") come in...");            start();        &#125;        public void run() &#123;            try &#123;                String line = bufferedReader.readLine();                while (!line.equals("bye")) &#123;                    printWriter.println("continue, Client(" + getName() + ")!");                    line = bufferedReader.readLine();                    System.out.println("Client(" + getName() + ") say: " + line);                &#125;                printWriter.println("bye, Client(" + getName() + ")!");                System.out.println("Client(" + getName() + ") exit!");                printWriter.close();                bufferedReader.close();                client.close();            &#125; catch (IOException e) &#123;            &#125;        &#125;    &#125;    public static void main(String[] args) throws IOException &#123;        new Server();    &#125;&#125;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/计算机网络作业-三/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/计算机网络作业-三/" itemprop="url">计算机网络作业(三)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:28:36+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  206
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>了解路由器，交换机的工作原理</p>
</blockquote>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>下载群里的思科模拟器（Cicso Packet）安装。<br>然后找到安装目录，把chinese.ptl重名名为default.ptl覆盖软件目录/language里面的default.ptl文件。这时候就汉化完成了。</p>
<h1 id="数据链路层模拟"><a href="#数据链路层模拟" class="headerlink" title="数据链路层模拟"></a>数据链路层模拟</h1><h2 id="第一个模拟"><a href="#第一个模拟" class="headerlink" title="第一个模拟"></a>第一个模拟</h2><p>按我爱自学网连接图如下：<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/2482741280.png?raw=true" alt="测试图.png"><br>右图给4个终端设置四个静态ip地址，如下图所示：<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/80357506.png?raw=true" alt="添加静态ip地址.png"><br>测试结果如下：<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/256654945.gif?raw=true" alt="测试结果.gif"></p>
<h2 id="第二个模拟"><a href="#第二个模拟" class="headerlink" title="第二个模拟"></a>第二个模拟</h2><p>和第一个一样设置IP地址<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/80357506.png?raw=true" alt="添加静态ip地址.png"><br>然后在交换机的命令行模式输入show mac-address-table<br>结果如下：<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/1361195517.png?raw=true" alt="mac地址查询.png"></p>
<h1 id="网络层模拟"><a href="#网络层模拟" class="headerlink" title="网络层模拟"></a>网络层模拟</h1><p>测试图测试图<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/1878580915.png?raw=true" alt="网络层测试图.png"><br>和数据链路层一样<br>设置静态ip<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/80357506.png?raw=true" alt="添加静态ip地址.png"><br>用PC-PT 1.1 ping 1.2和2.1<br>结果如下：<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/3077097446.png?raw=true" alt="不同vlan的ping测试.png"></p>
<p>还可以用路由器来进行交换操作</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/10/3857001773.png?raw=true" alt="添加路由器测试图.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/由txt文件制作带目录的kindle电子书/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/由txt文件制作带目录的kindle电子书/" itemprop="url">由txt文件制作带目录的kindle电子书</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:27:22+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  130
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="正则修改文章内容"><a href="#正则修改文章内容" class="headerlink" title="正则修改文章内容"></a>正则修改文章内容</h1><p>我们使用正则来更改正文，让标题用上markdown的标题样式“#”，正则如下：<br>查找：^(|)第(.<em>)卷替换：#第\2卷^表示一行的开始(|)表示空格(.</em>)任何字符<br>\2表示第二个括号的内容不改变</p>
<h1 id="使用calibre制作"><a href="#使用calibre制作" class="headerlink" title="使用calibre制作"></a>使用calibre制作</h1><p>注意生成步骤下的内容目录<br>h1对应//h:h1<br>h2对应//h:h2<br>等等</p>
<p>最后希望大家做出自己想要的电子书样式<br>放一张自己制作成功的图<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/2958088607.png?raw=true" alt="QQ截图20170930224307.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/解决typecho上传附件错误原因/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/解决typecho上传附件错误原因/" itemprop="url">解决typecho上传附件错误原因</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:26:28+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  323
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>前不久想写自己两天一夜的武功山之旅，结果发现图片无法上传，就一直搁置了，昨天因为快要交计算机网络作业了，所以顺便过来修一下，发现自己博客实用性不高，所以以后都会发2份备份，一份发到我在github上的静态博客，一份发到google blogger，用crontab -e写一下自动化脚本备份本站点的数据和sql到onedrive。</p>
</blockquote>
<h1 id="权限设置"><a href="#权限设置" class="headerlink" title="权限设置"></a>权限设置</h1><p>站点的根目录权限是www，用户组是root，大部分数据的权限应该是755，但是如果你的编辑器插件权限也只有755的话，他就没有写入权限，所以就无法上传。</p>
<p>我的情况是：<br>我从github上下载了一些typecho的主题和插件，然后用SFTP软件用root权限上传到网站根目录，所以我要用shell更改网站权限，用户和用户组。</p>
<p>如果没记错的话，当时我运行了下面一段命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R www:www dirsudo chmod -R 755 dir</span><br></pre></td></tr></table></figure>
<p>结果就是这段命令出了问题，把整个目录都改了可读，执行的权限，但是编辑器要求可写权限，那怎么办，改呗</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chomd -R 777 dir/var/plugins</span><br></pre></td></tr></table></figure>
<p>解决～</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lidongspace.cn/2018/04/24/计算机网络作业-二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="东东东东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lee's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/计算机网络作业-二/" itemprop="url">计算机网络作业(二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-24T23:24:58+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1,402
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<blockquote>
<p>这次的作业是写一个程序查看所有的网卡信息，并列出ip地址，子网掩码，网关地址，最好加一个关闭和重启网卡的功能，修改网卡信息功能，由于技术时间有限只完成了基本功能。以后会开发完的</p>
</blockquote>
<p>更新一：新增dns查询</p>
<h1 id="开发环境说明"><a href="#开发环境说明" class="headerlink" title="开发环境说明"></a>开发环境说明</h1><p>　　 我的电脑系统是Win10 pro</p>
<p> 　　开发环境是Visual Studio 2017</p>
<p> 　　使用语言：基于C++的MFC开发</p>
<h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><h2 id="新建一个MFC工程"><a href="#新建一个MFC工程" class="headerlink" title="新建一个MFC工程"></a>新建一个MFC工程</h2><p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/2217177798.png?raw=true" alt="img"></p>
<h2 id="更改文字的编码"><a href="#更改文字的编码" class="headerlink" title="更改文字的编码"></a>更改文字的编码</h2><p>我们需要多字节编码，不然的话不能使用汉语字符串</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/3450463252.png?raw=true" alt="img"></p>
<h2 id="设置图形界面"><a href="#设置图形界面" class="headerlink" title="设置图形界面"></a>设置图形界面</h2><p>我们需要2个Group box，一个Combo box，3个Edit Control和2个Button。两个Button一个用来初始化数据，一个用来根据网卡名来查询网卡信息。<br>图形界面如下所示：</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/3771151326.png?raw=true" alt="界面.png"></p>
<h2 id="设置关联变量"><a href="#设置关联变量" class="headerlink" title="设置关联变量"></a>设置关联变量</h2><p>右键-&gt;类向导-&gt;成员变量-&gt;添加变量</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/3325987580.png?raw=true" alt="添加成员变量.png"></p>
<p>添加combo变量</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/3896485204.png?raw=true" alt="建立conbo类对象.png"></p>
<p>添加edit变量</p>
<p>gateway(网关)</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/2616033225.png?raw=true" alt="网关变量设置.png"></p>
<p>像添加网关一样添加其他变量</p>
<h2 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h2><h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><h4 id="NetcardInfo-h添加"><a href="#NetcardInfo-h添加" class="headerlink" title="NetcardInfo.h添加"></a>NetcardInfo.h添加</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;resource.h&quot;       // 主符号</span><br><span class="line">#include &lt;WinSock2.h&gt;  </span><br><span class="line">#include &lt;Iphlpapi.h&gt;  </span><br><span class="line">#include &lt;iostream&gt; </span><br><span class="line">#pragma comment(lib, &quot;IPHLPAPI.lib&quot;)  </span><br><span class="line">#pragma comment(lib, &quot;ws2_32.lib&quot;)  </span><br><span class="line">using namespace std;</span><br></pre></td></tr></table></figure>
<h4 id="stdafx-h添加"><a href="#stdafx-h添加" class="headerlink" title="stdafx.h添加"></a>stdafx.h添加</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">extern CString cardname[10],ipaddress[10],ipmask[10],gateway[10];//显卡名，ip地址，子网掩码，网关</span><br><span class="line">extern int netCardNum;//网卡数量</span><br><span class="line">extern void start();//查看网卡信息函数eextern int dnsNum[10];</span><br><span class="line">extern void dnsget(int a);</span><br></pre></td></tr></table></figure>
<h3 id="正式代码"><a href="#正式代码" class="headerlink" title="正式代码"></a>正式代码</h3><h4 id="stdafx-app添加"><a href="#stdafx-app添加" class="headerlink" title="stdafx.app添加"></a>stdafx.app添加</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//变量声明</span><br><span class="line">CString cardname[10],ipaddress[10],ipmask[10],gateway[10];</span><br><span class="line">int netCardNum = 0;</span><br><span class="line">int dnsNum[10];</span><br><span class="line">void dnsget(int a);void start();</span><br></pre></td></tr></table></figure>
<h4 id="NetcardInfo-app添加"><a href="#NetcardInfo-app添加" class="headerlink" title="NetcardInfo.app添加"></a>NetcardInfo.app添加</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">void start()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    PIP_ADAPTER_INFO pIpAdapterInfo = new IP_ADAPTER_INFO();//PIP_ADAPTER_INFO结构体指针存储本机网卡信息  </span><br><span class="line">    unsigned long stSize = sizeof(IP_ADAPTER_INFO);         //得到结构体大小,用于GetAdaptersInfo参数  </span><br><span class="line">    int nRel = GetAdaptersInfo(pIpAdapterInfo, &amp;stSize);     //调用GetAdaptersInfo函数,填充pIpAdapterInfo指针变量;其中stSize参数既是一个输入量也是一个输出量  </span><br><span class="line"></span><br><span class="line">    int IPnumPerNetCard = 0; //记录每张网卡上的IP地址数量  </span><br><span class="line"></span><br><span class="line">    if (ERROR_BUFFER_OVERFLOW == nRel)</span><br><span class="line">    &#123;</span><br><span class="line">        //如果函数返回的是ERROR_BUFFER_OVERFLOW  </span><br><span class="line">        //则说明GetAdaptersInfo参数传递的内存空间不够,同时其传出stSize,表示需要的空间大小  </span><br><span class="line">        //这也是说明为什么stSize既是一个输入量也是一个输出量                 </span><br><span class="line">        delete pIpAdapterInfo;//释放原来的内存空间       </span><br><span class="line">        pIpAdapterInfo = (PIP_ADAPTER_INFO)new BYTE[stSize];//重新申请内存空间用来存储所有网卡信息          </span><br><span class="line">        nRel = GetAdaptersInfo(pIpAdapterInfo, &amp;stSize);    //再次调用GetAdaptersInfo函数,填充pIpAdapterInfo指针变量  </span><br><span class="line">    &#125;</span><br><span class="line">    if (ERROR_SUCCESS == nRel)</span><br><span class="line">    &#123;</span><br><span class="line">        //输出网卡信息  </span><br><span class="line">        //可能有多网卡,因此通过循环去判断  </span><br><span class="line">        while (pIpAdapterInfo)</span><br><span class="line">        &#123;</span><br><span class="line">            cardname[netCardNum] = pIpAdapterInfo-&gt;Description;</span><br><span class="line">            IP_ADDR_STRING pIpAddrString = &amp;(pIpAdapterInfo-&gt;IpAddressList);</span><br><span class="line">            ipaddress[netCardNum] = pIpAddrString-&gt;IpAddress.String;</span><br><span class="line">            ipmask[netCardNum] = pIpAddrString-&gt;IpMask.String;</span><br><span class="line">            gateway[netCardNum] = pIpAdapterInfo-&gt;GatewayList.IpAddress.String;</span><br><span class="line">            pIpAdapterInfo = pIpAdapterInfo-&gt;Next;</span><br><span class="line">dnsget(netCardNum);</span><br><span class="line">            netCardNum++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    //释放内存空间  </span><br><span class="line">    if (pIpAdapterInfo)</span><br><span class="line">    &#123;</span><br><span class="line">        delete pIpAdapterInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="添加事件处理"><a href="#添加事件处理" class="headerlink" title="添加事件处理"></a><em>添加事件处理</em></h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a><em>初始化</em></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//在BOOL CNetcardInfoDlg::OnInitDialog()函数中添加初始化事件</span><br><span class="line">    m_combo_CardName.SetWindowText(“下拉选单选取网卡”);</span><br><span class="line">    m_edit_ipaddress = “还没有选取网卡”;</span><br><span class="line">    m_edit_ipmask = “还没有选取网卡”;</span><br><span class="line">    m_edit_gateway = “还没有选取网卡”;</span><br><span class="line">        m_edit_dnsadd1= “还没有选取网卡”;</span><br><span class="line">    m_edit_dnsadd2 = “还没有选取网卡”;</span><br><span class="line">    start();</span><br><span class="line">        for (int i = 0; i &lt; netCardNum; i++)</span><br><span class="line">            m_combo_CardName.AddString(cardname[i]);</span><br></pre></td></tr></table></figure>
<h3 id="单击查询按钮事件"><a href="#单击查询按钮事件" class="headerlink" title="单击查询按钮事件"></a><em>单击查询按钮事件</em></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">void CNetcardInfoDlg::OnBnClickedOk()</span><br><span class="line">&#123;</span><br><span class="line">    // TODO: 在此添加控件通知处理程序代码</span><br><span class="line">    UpdateData(true);</span><br><span class="line">    CString str;</span><br><span class="line">    m_combo_CardName.GetWindowText(str);//获取选择的网卡名字</span><br><span class="line">    for (int i = 0; i&lt;netCardNum; i++)</span><br><span class="line">        if (str == cardname[i])</span><br><span class="line">        &#123;</span><br><span class="line">            m_edit_gateway = gateway[i];</span><br><span class="line">            m_edit_ipaddress = ipaddress[i];</span><br><span class="line">            m_edit_ipmask = ipmask[i];</span><br><span class="line">            if (dnsNum[i] == 2) &#123;</span><br><span class="line">                m_edit_dnsadd1 = dnsname1[i]; m_edit_dnsadd2 = dnsname2[i];</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">                if (dnsNum[i] == 1) &#123;</span><br><span class="line">                    m_edit_dnsadd1 = dnsname1[i]; m_edit_dnsadd2 = “第二个dns未设置”;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    m_edit_dnsadd2 = “第二个dns未设置”; m_edit_dnsadd1 = “第一个dns未设置”;</span><br><span class="line">                &#125;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    UpdateData(false);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dns查询功能<br><strong>在Netcardinfo.app中添加</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">void dnsget(int netCardNum)</span><br><span class="line">&#123;</span><br><span class="line">    FIXED_INFO  FixedInfo;     // 定义保存本地计算机网络参数信息的结构体指针</span><br><span class="line">    ULONG    ulOutBufLen;       // 保存获取到的本地计算机网络参数信息结构体链表的长度</span><br><span class="line">    DWORD    dwRetVal;          // 调用GetNetworkParams()函数的返回值</span><br><span class="line">    IP_ADDR_STRING  pIPAddr;   // 保存所有DNS服务器的IP地址列表</span><br><span class="line"></span><br><span class="line">                                // 获取信息</span><br><span class="line">    dnsNum[netCardNum] = 0;</span><br><span class="line">    FixedInfo = (FIXED_INFO )GlobalAlloc(GPTR, sizeof(FIXED_INFO));   // 为FixedInfo结构体分配内存空间</span><br><span class="line">    ulOutBufLen = sizeof(FIXED_INFO);         // 初始化ulOutBufLen变量值</span><br><span class="line"></span><br><span class="line">                                              // 第1次调用GetNetworkParams()函数，获取返回结果的大小到ulOutBufLen中</span><br><span class="line">    if (ERROR_BUFFER_OVERFLOW == GetNetworkParams(FixedInfo, ulOutBufLen)) &#123;</span><br><span class="line">        GlobalFree(FixedInfo);</span><br><span class="line">        FixedInfo = (FIXED_INFO *)GlobalAlloc(GPTR, ulOutBufLen);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 第2次调用GetNetworkParams()函数，以前面获取的ulOutBufLen作为参数，</span><br><span class="line">    if (dwRetVal = GetNetworkParams(FixedInfo, ulOutBufLen) != ERROR_SUCCESS) &#123;</span><br><span class="line">        printf(调用GetNetworkParams()函数失败。返回值: %08x\n;, dwRetVal);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        dnsname1[netCardNum] = FixedInfo-&gt;DnsServerList.IpAddress.String;</span><br><span class="line">        pIPAddr = FixedInfo-&gt;DnsServerList.Next;</span><br><span class="line">        dnsNum[netCardNum]++;</span><br><span class="line">        while (pIPAddr) &#123;</span><br><span class="line">            dnsname2[netCardNum]= pIPAddr-&gt;IpAddress.String;</span><br><span class="line">            pIPAddr = pIPAddr-&gt;Next;</span><br><span class="line">            dnsNum[netCardNum]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>​      效果如下</p>
<p><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/4122257067.gif?raw=true" alt="作业测试.gif"><br>增加dns后效果如下<br><img src="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/722461460.png?raw=true" alt="测试增加dns.png"></p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>​       <em>以前写的程序都不用写界面，还好上次数据库上机学会了一点MFC编程，去网上查了一下获得网卡信息的方法，然后学着调用，然后在MFC上用全局变量储存得到的网卡信息，然后用数据库编程的基础加到了软件上，还好最后成功了。最后感谢巨硬给了这么好的软件，调试特别好用哈哈哈。</em></p>
<p><em>附件下载：google网盘</em></p>
<p>本地下载:<a href="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/3555479341.rar" target="_blank" rel="noopener">NetcardInfo.rar</a></p>
<p><em>google blogger网页备份：链接</em></p>
<h2 id="新增dns查询功能，重新打包"><a href="#新增dns查询功能，重新打包" class="headerlink" title="新增dns查询功能，重新打包"></a>新增dns查询功能，重新打包</h2><p><a href="https://github.com/fantasylidong/fantasylidong.github.io/blob/master/images/uploads/2017/09/1986761986.rar" target="_blank" rel="noopener">本地下载：NetcardInfoaddns.rar</a></p>
<p>如果无法运行请安装<a href="https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads" target="_blank" rel="noopener">vc++2017依赖库</a>已经打包发布，不再需要</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">东东东东</p>
              <p class="site-description motion-element" itemprop="description">爱生活，所以爱blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">东东东东</span>

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共18.9k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
